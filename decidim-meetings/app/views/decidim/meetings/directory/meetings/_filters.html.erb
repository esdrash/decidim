<%# = render partial: "decidim/shared/filter_form_help", locals: { skip_to_id: "meetings" } %>

<div class="meeting-filter__container" data-filters data-component="accordion">
  <%= redesigned_filter_form_for filter, "", class: "meeting-search" do |form| %>
    <%= form.search_field :title_or_description_cont,
      label: false,
      placeholder: t("decidim.meetings.meetings.filters.search"),
      title: t("decidim.meetings.meetings.filters.search"),
      "aria-label": t("decidim.meetings.meetings.filters.search"),
      data: { disable_dynamic_change: true }
    %>
    <button type="submit" aria-controls="meetings" aria_label="<%= t("decidim.meetings.meetings.filters.search") %>">
      <%= icon "search-line"  %>
    </button>
  <% end %>

  <%
    filters = [];

    filters << ["date", "radio", :with_any_date, filter_date_values, "decidim.meetings.meetings.filters"] unless @forced_past_meetings;
    filters << ["type", "check_box", :with_any_type, filter_type_values, "decidim.meetings.meetings.filters"];

    # REDESIGN_PENDING: transform into array as the others
    #filters << ["scope", "check_box", :with_any_scope, directory_filter_scopes_values, "decidim.meetings.meetings.filters"];
    #filters << ["category", "check_box", :with_any_global_category, directory_filter_categories_values, "decidim.meetings.meetings.filters"];

    filters << ["origin", "check_box", :with_any_origin, directory_filter_origin_values, "decidim.meetings.meetings.filters"];
    filters << ["space_type", "check_box", :with_any_space, directory_meeting_spaces_values, "decidim.meetings.directory.meetings.index"];
    filters << ["activity", "radio", :activity, activity_filter_values, "decidim.meetings.meetings.filters"] if current_user;
  %>

  <% filters.each do |f| %>
    <div class="meeting-filter">
      <button data-controls="panel-<%= f[0] %>" data-open="true">
        <%= icon "arrow-down-s-line" %>
        <%= icon "arrow-up-s-line" %>
        <span><%= t(f[0], scope: f[4]) %></span>
      </button>
      <%= redesigned_filter_form_for filter, url_for, id: "panel-#{f[0]}", class: "meeting-filter__items" do |form| %>
        <%= form.send(
            f[1] == "radio" ? "collection_radio_buttons" : "collection_check_boxes",
            f[2],
            f[3],
            :first,
            :last
        ) do |builder|
              builder.label { builder.send(f[1] == "radio" ? "radio_button" : "check_box", class: "reset-defaults" , hidden: true ) + content_tag(:div, builder.text, class: "filter" ) }
          end %>
      <% end %>
    </div>
  <% end %>

  <%# REDESIGN_PENDING: nested filters are mocked %>
  <div class="meeting-filter">
    <button data-controls="panel-scope" data-open="true">
      <%= icon "arrow-down-s-line" %>
      <%= icon "arrow-up-s-line" %>
      <span><%= "SCOPE MOCK" %></span>
    </button>

    <form id="panel-scope" class="meeting-filter__items" action="/meetings/meetings" accept-charset="UTF-8" method="get">
      <input type="hidden" name="filter[with_any_date]" value="" autocomplete="off">

      <label for="no-childs">
        <input class="reset-defaults"
          type="checkbox" value="all" name="filter[with_any_date]"
          id="no-childs" hidden="hidden">

        <div class="filter">
          <%= icon "apps-2-line" %>
          <span>No childs</span>
        </div>
      </label>

      <label for="one-nest">
        <input
          class="reset-defaults" type="checkbox" value="upcoming" checked="checked" name="filter[with_any_date]"
          id="one-nest" hidden="hidden">

        <div class="filter">
          <%= icon "calendar-2-line" %>
          <span>One nesting level</span>
          <button data-controls="panel-one-nest" onclick="event.preventDefault()">
            <%= icon "arrow-down-s-fill" %>
            <%= icon "arrow-up-s-fill" %>
          </button>
        </div>
      </label>

      <div id="panel-one-nest" class="meeting-filter__items">
        <label for="one-child-1">
          <input
            class="reset-defaults" type="checkbox" value="upcoming" checked="checked" name="filter[with_any_date]"
            id="one-child-1" hidden="hidden">

          <div class="filter">
            <%= icon "calendar-2-line" %>
            <span>Option 1 in child</span>
          </div>
        </label>
        <label for="one-child-2">
          <input
            class="reset-defaults" type="checkbox" value="upcoming" checked="checked" name="filter[with_any_date]"
            id="one-child-2" hidden="hidden">

          <div class="filter">
            <%= icon "calendar-2-line" %>
            <span>Option 2 in child</span>
          </div>
        </label>
      </div>

      <label for="multi-nest">
        <input
          class="reset-defaults" type="checkbox" value="past" name="filter[with_any_date]"
          id="multi-nest" hidden="hidden">

        <div class="filter">
          <%= icon "calendar-check-line" %>
          <span>More nesting levels</span>
          <button data-controls="panel-multi-nest" data-open="false" onclick="event.preventDefault()">
            <%= icon "arrow-down-s-fill" %>
            <%= icon "arrow-up-s-fill" %>
          </button>
        </div>
      </label>

      <div id="panel-multi-nest" class="meeting-filter__items">
        <label for="multi-nest-1">
          <input
            class="reset-defaults" type="checkbox" value="upcoming" checked="checked" name="filter[with_any_date]"
            id="multi-nest-1" hidden="hidden">

          <div class="filter">
            <%= icon "calendar-2-line" %>
            <span>sublevel 1 element 1</span>
            <button data-controls="panel-multi-nest-1" data-open="false" onclick="event.preventDefault()">
              <%= icon "arrow-down-s-fill" %>
              <%= icon "arrow-up-s-fill" %>
            </button>
          </div>
        </label>

        <div id="panel-multi-nest-1" class="meeting-filter__items">
          <label for="multi-nest-1-1">
            <input
              class="reset-defaults" type="checkbox" value="past" name="filter[with_any_date]"
              id="multi-nest-1-1" hidden="hidden">

            <div class="filter">
              <%= icon "calendar-check-line" %>
              <span>sublevel 2 element 1</span>
            </div>
          </label>
          <label for="multi-nest-1-2">
            <input
              class="reset-defaults" type="checkbox" value="past" name="filter[with_any_date]"
              id="multi-nest-1-2" hidden="hidden">

            <div class="filter">
              <%= icon "calendar-check-line" %>
              <span>sublevel 2 element 2</span>
            </div>
          </label>
        </div>

        <label for="one-child-2">
          <input
            class="reset-defaults" type="checkbox" value="upcoming" checked="checked" name="filter[with_any_date]"
            id="one-child-2" hidden="hidden">

          <div class="filter">
            <%= icon "calendar-2-line" %>
            <span>sublevel 1 element 2</span>
            <button data-controls="panel-multi-nest-2" data-open="false" onclick="event.preventDefault()">
              <%= icon "arrow-down-s-fill" %>
              <%= icon "arrow-up-s-fill" %>
            </button>
          </div>
        </label>

        <div id="panel-multi-nest-2" class="meeting-filter__items">
          <label for="multi-nest-2-1">
            <input
              class="reset-defaults" type="checkbox" value="past" name="filter[with_any_date]"
              id="multi-nest-2-1" hidden="hidden">

            <div class="filter">
              <%= icon "calendar-check-line" %>
              <span>sublevel 2 element 1</span>
            </div>
          </label>
          <label for="multi-nest-2-2">
            <input
              class="reset-defaults" type="checkbox" value="past" name="filter[with_any_date]"
              id="multi-nest-2-2" hidden="hidden">

            <div class="filter">
              <%= icon "calendar-check-line" %>
              <span>sublevel 2 element 2</span>
            </div>
          </label>
        </div>
      </div>
    </form>
  </div>
</div>
