<%# = render partial: "decidim/shared/filter_form_help", locals: { skip_to_id: "meetings" } %>

<div class="meeting-filter__container" data-filters>
  <%= redesigned_filter_form_for filter, "", class: "meeting-search" do |form| %>
    <%= form.search_field :title_or_description_cont,
      label: false,
      placeholder: t("decidim.meetings.meetings.filters.search"),
      title: t("decidim.meetings.meetings.filters.search"),
      "aria-label": t("decidim.meetings.meetings.filters.search"),
      data: { disable_dynamic_change: true }
    %>
    <button type="submit" aria-controls="meetings" aria_label="<%= t("decidim.meetings.meetings.filters.search") %>">
      <%= icon "search-line"  %>
    </button>
  <% end %>

  <%
    filters = [];

    filters << ["date", "radio", :with_any_date, filter_date_values, "decidim.meetings.meetings.filters"] unless @forced_past_meetings;
    filters << ["type", "check_box", :with_any_type, filter_type_values, "decidim.meetings.meetings.filters"];

    # REDESIGN_PENDING: transform into array as the others
    #filters << ["scope", "check_box", :with_any_scope, directory_filter_scopes_values, "decidim.meetings.meetings.filters"];
    #filters << ["category", "check_box", :with_any_global_category, directory_filter_categories_values, "decidim.meetings.meetings.filters"];

    filters << ["origin", "check_box", :with_any_origin, directory_filter_origin_values, "decidim.meetings.meetings.filters"];
    filters << ["space_type", "check_box", :with_any_space, directory_meeting_spaces_values, "decidim.meetings.directory.meetings.index"];
    filters << ["activity", "radio", :activity, activity_filter_values, "decidim.meetings.meetings.filters"] if current_user;
  %>

  <% filters.each do |f| %>
    <div class="meeting-filter">
      <button id="dropdown-trigger-<%= f[0] %>" data-component="dropdown" data-target="dropdown-menu-<%= f[0] %>" data-auto-close="true">
        <%= icon "arrow-down-s-line" %>
        <%= icon "arrow-up-s-line" %>
        <span><%= t(f[0], scope: f[4]) %></span>
      </button>
      <%= redesigned_filter_form_for filter, url_for, id: "dropdown-menu-#{f[0]}" do |form| %>
        <%= form.send(
            f[1] == "radio" ? "collection_radio_buttons" : "collection_check_boxes",
            f[2],
            f[3],
            :first,
            :last
        ) do |builder|
              builder.label { builder.send(f[1] == "radio" ? "radio_button" : "check_box", class: "reset-defaults" , hidden: true ) + content_tag(:div, builder.text, class: "filter" ) }
          end %>
      <% end %>
    </div>
  <% end %>
</div>
